# アプリケーション開発仕様書：『俺の野球デイリー』

## 1. 文書概要

| 項目 | 内容 |
| :--- | :--- |
| **文書名** | アプリケーション開発仕様書：『俺の野球デイリー』 |
| **バージョン** | 1.0 |
| **作成日** | 2025年6月10日 |
| **目的** | 本仕様書は、野球の試合結果を要約して表示するモバイルアプリケーション『俺の野球デイリー』の開発を目的とし、その全体像、技術仕様、機能要件を定義する。これは、OpenAI ChatGPT（GPT-4）がコードを生成するためのマスタープロンプトとして機能する。 |

## 2. プロジェクト概要

### 2.1. アプリケーション名
俺の野球デイリー (My Baseball Daily)

### 2.2. 解決する課題
ユーザーが、Google Discoverなどのニュースフィードで、ひいきの野球チームに関する短い記事（試合結果、選手インタビューなど）をだらだらと読み続けてしまい、意図せず時間を浪費してしまう。

### 2.3. 目的と提供価値
ひいきのチームの最新の試合結果と主要な情報を、1ページに集約して表示する。ユーザーはアプリを開くだけで必要な情報を効率的に得られ、時間の浪費を防ぐことができる。「知りたいことだけを知る」という目的達成型の情報収集体験を提供する。

## 3. 主要な概念と用語定義

| 用語 | 定義 |
| :--- | :--- |
| **ひいきのチーム** | ユーザーが応援している特定のプロ野球チーム。本仕様書では「DeNAベイスターズ」を対象として実装する。 |
| **試合結果** | ひいきのチームの直近の試合に関する情報。スコア、対戦相手、勝敗、ヒーローインタビュー記事へのリンクなどを含む。 |

## 4. 技術スタック・アーキテクチャ

本プロジェクトは、pnpmワークスペースを利用したモノレポ構成で開発する。

| 領域 | 技術 | 役割・備考 |
| :--- | :--- | :--- |
| **パッケージ管理** | **pnpm** | ワークスペース機能を利用したモノレポ管理 |
| **バックエンド** | **Cloudflare Workers** | データ収集・API提供。Cron Triggerで定時実行。 |
| **データベース** | **Cloudflare KV** | 試合結果データを保存するKey-Valueストア。 |
| **フロントエンド** | **Expo (React Native)** | iOS/Android対応のモバイルアプリケーション。 |
| **JSエンジン** | **Hermes** | Expoのデフォルト。高速起動とパフォーマンスを担保。 |
| **共有コード** | `packages/types` | バックエンドとフロントエンドで共有するTypeScriptの型定義。 |

## 5. 機能要件

### 5.1. バックエンド要件 (Cloudflare Worker)

#### FR-B-01: 試合結果の自動収集
- **処理概要:** 毎日1回、日本時間の午前6時に自動で実行され、指定されたWebサイトから試合結果をスクレイピングする。
- **実行トリガー:** Cloudflare Cron Triggers (`cron = "0 21 * * *" ※UTCのため前日の21時)
- **収集元サイト(仮):** Yahoo!スポーツ プロ野球 (`https://baseball.yahoo.co.jp/npb/`)
- **収集対象チーム:** 読売ジャイアンツ
- **収集データ項目:**
    - `date`: 試合日 (ISO 8601形式)
    - `opponent`: 対戦相手チーム名
    - `score`: 最終スコア (例: "5 - 3")
    - `result`: 勝敗 ("win", "lose", "draw" のいずれか)
    - `heroUrl`: ヒーローインタビュー記事のURL (存在する場合のみ)
    - `managerCommentUrl`: 監督コメント記事のURL (存在する場合のみ)
- **実装詳細:** HTMLの解析には`cheerio`ライブラリを使用する。CSSセレクタは変更される可能性があるため、後で人間が修正しやすいようにコードを記述すること。

#### FR-B-02: 収集データの保存
- **処理概要:** FR-B-01で収集したデータをCloudflare KVに保存する。
- **キー:** 試合日の年月日 (`YYYY-MM-DD`形式)
- **バリュー:** 収集したデータ項目をJSON文字列化したもの。

#### FR-B-03: APIエンドポイントの提供
- **処理概要:** フロントエンドアプリからのリクエストに応じて、KVに保存された最新の試合結果を返すAPIを提供する。
- **エンドポイント:** `GET /api/latest-game`
- **成功レスポンス (200 OK):**
    ```json
    {
      "success": true,
      "data": {
        "date": "...",
        "opponent": "...",
        // ... 他のデータ項目
      }
    }
    ```
- **失敗レスポンス (404 Not Found):** データが一件も存在しない場合。
    ```json
    {
      "success": false,
      "error": "No game data found."
    }
    ```
- **その他:** Expoアプリからアクセスするため、CORSヘッダーを適切に設定すること。

### 5.2. フロントエンド要件 (Expo App)

#### FR-F-01: ダッシュボード画面
- **ユーザーストーリー:** ユーザーとして、アプリを開くとすぐに、ひいきのチームの最新の試合結果を見たい。
- **画面表示ロジック:**
    1.  **起動時:** ローディングインジケーターを表示し、バックエンドの`GET /api/latest-game`にリクエストを送信する。
    2.  **データ取得成功時:** 取得した試合結果情報を画面に表示する。
    3.  **データ取得失敗時:** エラーメッセージと「再試行」ボタンを表示する。
- **表示コンポーネント:**
    - **試合日:** "2025年6月9日 の試合" のように表示。
    - **対戦カード:** "vs 阪神タイガース" のように表示。
    - **スコア:** "5 - 3" のように大きく表示。勝敗（`result`）に応じて文字色を変更する（win: 青系, lose: 赤系, draw: グレー系）。
    - **リンクボタン:** `heroUrl`や`managerCommentUrl`が存在する場合のみ、「ヒーローインタビュー」「監督コメント」ボタンを表示。タップすると、OSのブラウザで該当URLを開く。
- **アクション:**
    - **引っ張って更新:** 画面を下にスワイプすると、データを再取得する（Pull-to-Refresh）。

## 6. 非機能要件

| 項目 | 要件 |
| :--- | :--- |
| **パフォーマンス** | アプリ起動から試合結果が表示されるまで3秒以内を目指す。Hermesの性能を活かす。 |
| **ユーザビリティ**| 最小限の操作で目的を達成できる、シンプルで直感的なUI。 |
| **保守性** | 各関数やコンポーネントの役割が明確で、後から修正しやすいように、適切なコメントを含むクリーンなコードを記述すること。 |

## 7. 画面構成とワイヤーフレーム

テキストベースのワイヤーフレームで、ダッシュボード画面のレイアウトを定義する。

```plaintext
+-----------------------------------------------------+
|   [ステータスバー]                                  |
|-----------------------------------------------------|
|                                                     |
|   俺の野球デイリー ⚾                               |
|   ===============================================   |
|                                                     |
|   +---------------------------------------------+   |
|   |  2025年6月9日 の試合                        |   |
|   |                                             |   |
|   |  vs 阪神タイガース                           |   |
|   |                                             |   |
|   |  [ G ]             5 - 3              [ T ] |   |
|   |   (WIN)                                     |   |
|   |                                             |   |
|   +---------------------------------------------+   |
|                                                     |
|   +---------------------------------------------+   |
|   |  [ ヒーローインタビューを読む ] (ボタン)      |   |
|   +---------------------------------------------+   |
|                                                     |
|   +---------------------------------------------+   |
|   |  [ 監督コメントを見る ] (ボタン)            |   |
|   +---------------------------------------------+   |
|                                                     |
|                                                     |
+-----------------------------------------------------+
```
